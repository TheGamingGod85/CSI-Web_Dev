<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Management</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #e0f7fa;
            color: #333;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
            color: #00796b;
            text-shadow: 2px 2px #b2dfdb;
        }
        .task-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        .task-tile {
            background: #fff;
            border: 2px dashed #00796b;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }
        .task-tile:hover {
            transform: scale(1.05);
        }
        .high-priority {
            background-color: #ffccbc;
            border-left: 5px solid #d32f2f;
        }
        .medium-priority {
            background-color: #ffe0b2;
            border-left: 5px solid #ffa000;
        }
        .low-priority {
            background-color: #c8e6c9;
            border-left: 5px solid #388e3c;
        }
        .pending {
            border-bottom: 4px solid orange;
        }
        .ongoing {
            border-bottom: 4px solid #1976d2;
        }
        .done {
            border-bottom: 4px solid #388e3c;
        }
        .backlog {
            border-bottom: 4px solid red;
        }
        .button-container {
            margin-top: 10px;
            text-align: center;
        }
        .btn {
            padding: 8px 15px;
            margin: 5px;
            cursor: pointer;
            background-color: #00796b;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #004d40;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 15px;
            width: 80%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .filter-sort-container {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin: 0 20px;
        }
        .filter-sort-container select, .filter-sort-container button {
            padding: 10px;
            margin: 0 5px;
            border-radius: 5px;
            border: 1px solid #00796b;
            font-weight: bold;
        }
        .filter-sort-container button {
            background-color: #00796b;
            color: white;
        }
        .filter-sort-container button:hover {
            background-color: #004d40;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0, 0, 0, 0.7); /* Black w/ opacity */
            padding-top: 60px; /* Padding from the top */
        }

        .modal-content {
            background-color: #fefefe; /* White background */
            margin: 5% auto; /* 15% from the top and centered */
            padding: 20px; /* Padding inside the modal */
            border: 2px solid #00796b; /* Border color */
            border-radius: 15px; /* Rounded corners */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); /* Shadow for depth */
            width: 80%; /* Width of the modal */
            max-width: 600px; /* Max width for larger screens */
            animation: slideIn 0.4s; /* Animation for modal */
        }

        .close {
            color: #aaa; /* Close button color */
            float: right; /* Align to the right */
            font-size: 28px; /* Font size */
            font-weight: bold; /* Bold text */
        }

        .close:hover,
        .close:focus {
            color: #ff5252; /* Change color on hover */
            text-decoration: none; /* No underline */
            cursor: pointer; /* Pointer cursor */
        }

        @keyframes slideIn {
            from {
                opacity: 0; /* Start invisible */
                transform: translateY(-50px); /* Start above */
            }
            to {
                opacity: 1; /* End visible */
                transform: translateY(0); /* End at original position */
            }
        }

        .modal h2 {
            color: #00796b; /* Title color */
            text-align: center; /* Center title */
            margin-bottom: 15px; /* Space below title */
        }

        .modal label {
            display: block; /* Make labels block elements */
            margin: 10px 0 5px; /* Space around labels */
        }

        .modal input[type="text"],
        .modal input[type="date"],
        .modal select {
            width: calc(100% - 20px); /* Full width minus padding */
            padding: 10px; /* Padding inside input fields */
            margin: 5px 0 15px 10px; /* Space around inputs */
            border: 1px solid #00796b; /* Input border color */
            border-radius: 5px; /* Rounded corners for inputs */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Shadow for inputs */
            transition: border 0.3s; /* Transition for border */
            box-sizing: border-box; /* Ensure padding is included in width */
        }


        .modal input[type="text"]:focus,
        .modal input[type="date"]:focus,
        .modal select:focus {
            border-color: #004d40; /* Darker border on focus */
        }

        .modal button {
            background-color: #00796b; /* Button background color */
            color: white; /* Button text color */
            border: none; /* No border */
            border-radius: 5px; /* Rounded corners for buttons */
            padding: 10px 15px; /* Padding inside buttons */
            cursor: pointer; /* Pointer cursor */
            font-weight: bold; /* Bold text */
            transition: background-color 0.3s; /* Transition for background */
        }

        .modal button:hover {
            background-color: #004d40; /* Darker button on hover */
        }

    </style>
</head>
<body>
    <h1>Task Management</h1>
    <div class="filter-sort-container">
        <button id="openModal">Create New Task</button>
        <div>
            <!-- <select id="filterStatus">
                <option value="">Filter by Status</option>
                <option value="pending">Pending</option>
                <option value="ongoing">Ongoing</option>
                <option value="done">Done</option>
                <option value="backlog">Backlog</option>
            </select> -->
            <label for="dateSearch">Search by Due Date:</label>
            <input type="date" id="dateSearch" />
            
            <label for="sortDateDropdown">Sort by Due Date:</label>
            <select id="sortDateDropdown">
                <option value="asc">Ascending</option>
                <option value="desc">Descending</option>
            </select>
            <button id="resetFiltersButton" class="btn">Reset Filters</button>

        </div>
    </div>

    <div id="task-container" class="task-container"></div>

    <!-- Modal for creating and editing tasks -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">Create New Task</h2>
            <form id="taskForm">
                <label for="title">Title:</label>
                <input type="text" id="title" required>
                <label for="priority">Priority:</label>
                <select id="priority" required>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
                <label for="dueDate">Due Date:</label>
                <input type="date" id="dueDate" required>
                <label for="status">Status:</label>
                <select id="status" required>
                    <option value="pending">Pending</option>
                    <option value="ongoing">Ongoing</option>
                    <option value="done">Done</option>
                    <option value="backlog">Backlog</option>
                </select>
                <button type="submit">Save Task</button>
            </form>
        </div>
    </div>

    <script>
        let currentTaskId = null; // For editing tasks
        let sortOrder = 'asc'; // Default sort order
        let dateSortOrder = 'asc'; // Default date sort order

        // Function to fetch tasks
        async function fetchTasks(filter = '', dateFilter = '') {
            try {
                const url = new URL('http://localhost:3000/tasks');

                // Add filter for status if provided
                if (filter) {
                    url.searchParams.append('status', filter);
                }

                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                let tasks = await response.json();
                const taskContainer = document.getElementById('task-container');
                taskContainer.innerHTML = '';

                // Filter tasks by due date if a date is provided
                if (dateFilter) {
                    tasks = tasks.filter(task => {
                        const taskDueDate = new Date(task.dueDate).toISOString().split('T')[0]; // Format as YYYY-MM-DD
                        return taskDueDate === dateFilter; // Compare only the date part
                    });
                }

                // Sort tasks by status first, then by priority, and finally by due date
                tasks.sort((a, b) => {
                    // Status comparison
                    const statusOrder = ['pending', 'ongoing', 'done', 'backlog'];
                    const statusComparison = statusOrder.indexOf(a.status) - statusOrder.indexOf(b.status);
                    if (statusComparison !== 0) {
                        return statusComparison; // Sort by status first
                    }

                    // Priority comparison
                    const priorityOrder = ['low', 'medium', 'high'];
                    let priorityComparison = priorityOrder.indexOf(a.priority) - priorityOrder.indexOf(b.priority);
                    if (sortOrder === 'desc') {
                        priorityComparison = -priorityComparison; // Adjust based on sort order
                    }

                    // Due date comparison
                    const dateA = new Date(a.dueDate).getTime();
                    const dateB = new Date(b.dueDate).getTime();
                    let dateComparison = dateA - dateB;
                    if (dateSortOrder === 'desc') {
                        dateComparison = -dateComparison; // Adjust based on sort order
                    }

                    return dateComparison || priorityComparison; // First sort by date, then by priority
                });

                // Create tiles for each task
                tasks.forEach(task => {
                    const tile = document.createElement('div');
                    tile.className = 'task-tile';

                    let priorityClass = task.priority === 'high' ? 'high-priority' : task.priority === 'medium' ? 'medium-priority' : 'low-priority';
                    let statusClass = task.status === 'pending' ? 'pending' : task.status === 'ongoing' ? 'ongoing' : task.status === 'done' ? 'done' : 'backlog';

                    tile.innerHTML = `
                        <div class="task-title ${priorityClass}">${task.title}</div>
                        <div class="task-info"><strong>Priority:</strong> ${task.priority}</div>
                        <div class="task-info"><strong>Due Date:</strong> ${new Date(task.dueDate).toLocaleDateString()}</div>
                        <div class="task-info"><strong>Created At:</strong> ${new Date(task.createdAt).toLocaleDateString()}</div>
                        <div class="task-footer ${statusClass}"><strong>Status:</strong> ${task.status}</div>
                        <div class="button-container">
                            <button class="btn edit-btn" onclick="openEditModal(${task.id})">Edit</button>
                            <button class="btn delete-btn" onclick="deleteTask(${task.id})">Delete</button>
                        </div>
                    `;
                    taskContainer.appendChild(tile);
                });
            } catch (error) {
                console.error('Error fetching tasks:', error);
            }
        }

        // Reset function to clear filters
        function resetFilters() {
            document.getElementById('dateSearch').value = ''; // Clear date search input
            document.getElementById('sortDropdown').selectedIndex = 0; // Reset priority sort dropdown to default
            document.getElementById('sortDateDropdown').selectedIndex = 0; // Reset date sort dropdown to default

            // Fetch all tasks without filters
            fetchTasks(); // Call fetchTasks without any parameters
        }

        // Event listener for the reset filters button
        document.getElementById('resetFiltersButton').onclick = resetFilters;
                            


        async function openEditModal(taskId) {
            currentTaskId = taskId;
            const response = await fetch(`http://localhost:3000/tasks/${taskId}`);
            const task = await response.json();

            document.getElementById('modalTitle').innerText = 'Edit Task';
            document.getElementById('title').value = task.title;
            document.getElementById('priority').value = task.priority;
            document.getElementById('dueDate').value = new Date(task.dueDate).toISOString().split('T')[0];
            document.getElementById('status').value = task.status;
            document.getElementById('taskModal').style.display = 'block';
        }

        async function deleteTask(taskId) {
            const confirmed = confirm('Are you sure you want to delete this task?');
            if (confirmed) {
                await fetch(`http://localhost:3000/tasks/${taskId}`, { method: 'DELETE' });
                fetchTasks(); // Refresh the task list
            }
        }

        function openCreateModal() {
            currentTaskId = null; // Reset for new task
            document.getElementById('modalTitle').innerText = 'Create New Task';
            document.getElementById('taskForm').reset(); // Clear the form
            document.getElementById('taskModal').style.display = 'block';
        }

        async function handleFormSubmit(event) {
            event.preventDefault();
            const title = document.getElementById('title').value;
            const priority = document.getElementById('priority').value;
            const dueDate = document.getElementById('dueDate').value;
            const status = document.getElementById('status').value;

            const url = currentTaskId ? `http://localhost:3000/tasks/${currentTaskId}` : `http://localhost:3000/tasks/new`;
            const method = currentTaskId ? 'PUT' : 'POST';

            try {
                await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, priority, dueDate, status })
                });
                fetchTasks(); // Refresh the task list
                closeModal();
            } catch (error) {
                console.error('Error saving task:', error);
            }
        }

        function closeModal() {
            document.getElementById('taskModal').style.display = 'none';
        }

        document.getElementById('openModal').onclick = openCreateModal;
        document.getElementById('applyFilters').onclick = () => {
            const filter = document.getElementById('filterStatus').value;
            const sort = document.getElementById('sortPriority').value;
            fetchTasks(filter, sort);
        };
        document.querySelector('.close').onclick = closeModal;
        document.getElementById('taskForm').onsubmit = handleFormSubmit;

        // Initial fetch
        fetchTasks();
    </script>
</body>
</html>
